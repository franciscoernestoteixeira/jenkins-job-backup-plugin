<?jelly escape-by-default='true'?>
<j:jelly xmlns:j="jelly:core"
         xmlns:f="/lib/form"
         xmlns:l="/lib/layout"
         xmlns:st="jelly:stapler">

    <l:layout title="Job Backup &amp; Restore">

        <!-- Load shared CSS/JS once for this view -->
        <st:adjunct includes="io.jenkins.plugins.jobbackup.ui.jobbackup"/>

        <l:side-panel>
            <l:app-bar title="Job Backup &amp; Restore"/>

            <l:tasks>
                <l:task title="Export" href="/manage/job-backup/"
                        icon="symbol-cloud-download-outline plugin-ionicons-api"/>
                <l:task title="Import" href="/manage/job-backup/import"
                        icon="symbol-cloud-upload-outline plugin-ionicons-api"/>
            </l:tasks>
        </l:side-panel>

        <l:main-panel>
            <l:app-bar title="Export"/>

            <j:set var="error" value="${request.getParameter('error')}"/>
            <j:if test="${error != null}">
                <div class="jenkins-alert jenkins-alert-warning jobbackup-alert">
                    <span class="jobbackup-icon">
                        <l:icon src="symbol-warning-outline plugin-ionicons-api"/>
                    </span>
                    <span class="jobbackup-item-text">
                        ${error}
                    </span>
                </div>
            </j:if>

            <div class="jobbackup-spacer">Export selected jobs and folders into a ZIP archive.</div>

            <f:form method="post" action="exportZip">
                <table class="jenkins-table" data-jobbackup-table="export">
                    <thead>
                        <tr>
                            <th class="jenkins-table__cell--tight">
                                <!-- Select/Deselect all -->
                                <f:checkbox
                                        name="_selectAll"
                                        value="true"
                                        checked="false"
                                        cssClass="jobbackup-select-all"
                                        aria-label="Select all"
                                        data-jobbackup-action="select-all"/>
                            </th>
                            <th>Full name</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        <j:forEach var="row" items="${it.allItems}">
                            <tr data-id="${row.fullName}"
                                data-parent-id="${row.parentFullName}"
                                data-type="${row.folder ? 'folder' : 'job'}">
                                <td class="jenkins-table__cell--tight">
                                    <f:checkbox name="selected"
                                                value="${row.fullName}"
                                                cssClass="jobbackup-row-check"
                                                data-jobbackup-action="toggle-row"/>
                                </td>
                                <td>
                                    <div class="jobbackup-item"
                                         data-jobbackup-depth="${row.depth}">
                                        <span class="jobbackup-icon">
                                            <l:icon
                                                    src="${row.iconSymbol} plugin-ionicons-api"
                                                    tooltip="${row.type}"/>
                                        </span>
                                        <span class="jobbackup-item-text">
                                            ${row.leafName}
                                        </span>
                                    </div>
                                </td>
                                <td>${row.type}</td>
                            </tr>
                        </j:forEach>
                    </tbody>
                </table>

                <f:submit value="Download"/>
            </f:form>

        </l:main-panel>
    </l:layout>

</j:jelly>
